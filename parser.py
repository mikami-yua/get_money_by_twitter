# twitter_bot/parser.py
import re


def extract_password(tweet_text: str) -> str | None:
    """
    ä½¿ç”¨ä¸€ç³»åˆ—æ­£åˆ™è¡¨è¾¾å¼ï¼ŒæŒ‰é¡ºåºä»æ¨æ–‡æ–‡æœ¬ä¸­æå–å£ä»¤ã€‚
    """
    # é¢„å¤„ç†ï¼šåªæ›¿æ¢å…¨è§’å†’å·ï¼Œæš‚æ—¶ä¿ç•™ç©ºæ ¼ï¼Œè®©æ­£åˆ™å¤„ç†
    processed_text = tweet_text.replace('ï¼š', ':').lower()

    # --- æ­£åˆ™è¡¨è¾¾å¼è§„åˆ™åˆ—è¡¨ (v5 ä¿®å¤ç‰ˆ - å¤„ç†URLæ±¡æŸ“é—®é¢˜) ---
    # !! æ ¸å¿ƒæ”¹åŠ¨ï¼šä½¿ç”¨éè´ªå©ªåŒ¹é…å’Œå…ˆè¡Œæ–­è¨€æ¥ç•Œå®šå¯†ç è¾¹ç•Œ !!
    patterns = [
        ("å›ºå®šå¼•å¯¼è¯+å†’å·", r'(?:å£ä»¤æ˜¯|å£ä»¤|password)\s*:\s*([a-z0-9_\u4e00-\u9fa5]+?)(?=[^a-z0-9_\u4e00-\u9fa5]|$)'),
        ("æ”¯ä»˜å®å¼•å¯¼è¯+å†’å·", r'æ”¯ä»˜å®\s*:\s*([a-z0-9_\u4e00-\u9fa5]+?)(?=[^a-z0-9_\u4e00-\u9fa5]|$)'),
        ("æ‹¬å·/å¼•å·å¼•å¯¼", r'(?:å£ä»¤|å¯†ç )\s*[ã€Œï¼ˆã€]\s*([a-z0-9_\u4e00-\u9fa5]+?)\s*[ã€ï¼‰ã€‘]'),
        ("å…³é”®è¯+å†’å·", r'å£ä»¤çº¢åŒ….*?\s*[:]\s*([a-z0-9_\u4e00-\u9fa5]+?)(?=[^a-z0-9_\u4e00-\u9fa5]|$)'),
        ("å…³é”®è¯ç´§é‚»æ•°å­—", r'æ”¯ä»˜å®å£ä»¤çº¢åŒ…\s*(\d{6,})'),
        ("çº¯æ•°å­—é•¿å£ä»¤", r'^\s*(\d{8,})\s*$'),
    ]

    print(f"\n--- æ­£åœ¨è§£ææ–‡æœ¬: '{tweet_text[:40]}...'")
    for description, pattern in patterns:
        match = re.search(pattern, processed_text)
        if match:
            # group(1) ä»ç„¶æ˜¯æˆ‘ä»¬çš„ç›®æ ‡
            password = match.group(1).strip()  # strip() ç§»é™¤å¯èƒ½æ•è·åˆ°çš„å‰åç©ºæ ¼
            if password in ["çº¢åŒ…", "ç§ä¿¡", "å·²å‘"]:
                continue
            print(f"    âœ… åŒ¹é…æˆåŠŸ! è§„åˆ™: '{description}', ç»“æœ: '{password}'")
            return password

    print("    ğŸ¤· æ‰€æœ‰è§„åˆ™å‡æœªåŒ¹é…æˆåŠŸã€‚")
    return None